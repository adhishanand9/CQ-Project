<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CQ</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src="/trumbowyg.min.js"></script>
  <script>
      $(document).ready( function () {
      $('#myTable').DataTable();
      } );
  </script>
    <style>
      *{
        box-sizing: border-box;
      }
      body{
        margin: 0;
        padding: 0;
        width: 100%;
        background: #f5f5f5;
        font-family: 'Roboto', sans-serif;
  }
  nav{
          position: absolute;
          width:100%;
          height: 60px;
    background-color: #222D3C;
          color: #fff;
  }
  nav p {
    margin: 0;
          float: left;
          height: 50px;
          padding: 15px 15px;
          font-size: 20px;
          line-height: 20px;
          font-weight: bold;
  }
  nav span {
          float: right;
          padding: .2em .6em .3em;
          margin-top: 22px;
          margin-left: 5px;
          font-size: 75%;
          line-height: 1;
          font-weight: 700;
          color: #fff;
          font-size: 14px;
          vertical-align: center;
          border-radius: .25em;
          vertical-align: baseline;
  }
  nav img {
    float: right;
    border-radius: 50%;
    padding: 15px;
      }
  #menu {
          padding-top: 60px;
          background-color: #000;
          width: 50px;
          height:100vh;
          color:white;
          box-sizing: border-box;
          overflow:hidden;
  }
  .fa {
    color: #fff;
    font-size: 25px;
    width: 30px;
    margin: 6px 15px;
    margin-left: 11px;
    box-sizing: border-box;
  }
  .menu-item {
          width: 250px;
    cursor: pointer;
    opacity: 0.8;
    color: #fff;
    font-family: sans-serif;
    font-size: 14px;
          padding-top: 10px;
  }
  .menu-item:hover {
    border-left: 2px solid red;
    opacity: 1;
    background-color: #4d5866;
  }
      #user_icon{
          height:100%;
          width: 10%;
      }
      .active{
          background: #51a1e2 !important;
      }
      #profile_button{
          cursor: pointer;
          padding: 0px;
          padding-left: 5px;
          padding-top: 5px;
          height: 60px;
      }
      #body_div{
    position:absolute;
    left:50px;
    right:0;
    top:64px;
    bottom:0;
    margin-left: 0.5%;
    overflow:auto;
      }
      table{
          min-width: 50%;
          width: auto;
          border: 1px solid rgb(201, 201, 201);
      }

  #refresh {
    background-color: #2D312C;
    width: 100px;
    font-size: 18px;
    padding: 6px;
    text-align: center;
    float: right;
    cursor: pointer;
  }
  #head-btns {
    padding-top: 5px;
  }
  #filter {
    width: 150px;
    background-color: #2D312C;
    color: white;
    height: 35px;
    border-radius: 5px;
    padding-left: 10px;
    margin-right: 10px;
    float: right;
  }
  #role {
    background-color: #2D312C;
    width: 200px;
    color: white;
    height: 35px;
    padding-left: 10px;
    border-radius: 5px;
    float: right;
  }
  .actions-btn {
    width: 35px;
    height: 35px;
    margin: 5px 5px 0;
    padding: 5px;
  }
  .actions-btn span {
    color: #fff;
    font-size: 15px;
    width: auto;
    margin: 0;
    box-sizing: initial;
  }
  #community_list_icon{
    height:70px;
    width:70px;
    border: 2px solid green;
  }
  .actions i {
    background-color: #000;
    font-size: 16px;
    text-align: center;
    padding: 6px;
    cursor: pointer;
  }
  </style>
  </head>
  <body>
    <% include partials/menu.html %>
      <div id="body_div">
          <div id="head-btns">
                  <span id="tag">Community List</span>
                  <select id="filter">
                      <option value="All">All</option>
                      <option value="direct">Direct</option>
                      <option value="permission">Permission</option>
                  </select>
                  <span id="refresh" class="fa fa-refresh">Refresh</span>
          </div>
          <table id="myTable" class="display" style="width:100%">
                  <thead>
                      <tr>
                          <th>Community Name</th>
                          <th>Membership Rule</th>
                          <th>Community Location</th>
                          <th>Community Owner</th>
                          <th>Create Date</th>
                          <th>Actions</th>
                          <th>Community Pic</th>
                      </tr>
                  </thead>
                  <tbody>
                    <%communitydata.forEach(function(d) { %>
                      <tr>
                      <td><%=d.comname%></td>
                      <td><%=d.membershiprule%></td>
                      <td><%=d.location%></td>
                      <td><%=d.owner%></td>
                      <td><%=d.createdate%></td>
                      <td class="actions" align=center></td>
                      <td align=center><img src=/<%=d.image%> id="community_list_icon" height=35px></td>
                    </tr>
                    <%})%>
                  </tbody>
          </table>
      </div>
      <div id="updateModal" class="modal fade" role="dialog" style="z-index:9999;">
                                        <div class="modal-dialog">
                                            <div class="modal-content">

                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                     <h3 id="eheading" style="text-align:left;" class="modal-title">Update <span id="nameses"></span></h3>
                                                </div>

                                                <div class="modal-body">
                                                        <div class="form-horizontal">
                                                        <div class="form-group">
                                                            <div class="col-lg-5 col-lg-offset-3" style="width:50%;">
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">Commuity Name:</label>
                                                            <div class="col-sm-10">
                                                                <input type="text" class="form-control" id="username" placeholder="Username" readonly>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">Community Status:</label>
                                                            <div class="col-sm-10">
                                                                <select class="form-control" id="role">
                                                                    <option value="Active">Active</option>
                                                                    <option value="Deactive">Deactive</option>
                                                                </select>
                                                            </div>
                                                        </div>



                                                        <div class="form-group">
                                                            <div class="col-sm-offset-2 col-sm-10" style="text-align:left;">
                                                                <button class = "btn btn-default" id="editsubmit" data-dismiss="modal" onclick="updateCommunitydetails()">Update</button>
                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>

                                                <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                </div>
                                        </div>
                                    </div>
                                </div>




<!-- Info Modal modal -->


<div id="infoModal" class="modal fade" role="dialog" style="z-index:9999;">
                                        <div class="modal-dialog">
                                            <div class="modal-content">

                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                    <div style="display: flex;">
                                                    <img src="uploads/defaultCommunity.jpg" id="CommunityProfilePic" style="width: 100px;height: 100px;">
                                                     <h3 id="eheading" style="text-align:left;margin-top: 35px;margin-left: 10px;" class="modal-title">Community <span id="memes"></span></h3>
                                                     </div>
                                                </div>

                                                <p style="font-size:15px;font-weight:bold;padding: 10px;">Community Description</p>
                                                <p id="locInfo" style="font-size:15px;margin-left: 15px;float:left"></p>
                                                <div id="communityDesc" class="well well-lg" style="word-wrap: break-word;"></div>

                                                <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                </div>
                                        </div>
                                    </div>
                                </div>


  </body>
  <script>

  var span = menu.getElementsByTagName("span");
  var div = menu.getElementsByTagName('div');
  for(var i=0;i<div.length;i++){
      div[i].classList.remove("active");
    }

    div[4].classList.add("active");

$(document).ready(function(){
  $("#sideBtn").click(function(){
     if($("#menu").width() == 50){
        $("#menu").animate({width: '250px'},300);
        $("#body_div").animate({left:'250px'},300);
     } else{
        $("#menu").animate({width: '50px'},300);
        $("#body_div").animate({left:'50px'},300);
     }
  });
});
var actionBtns = document.getElementsByClassName("actions");
for(var i = 0;i<actionBtns.length;i++) {
 var editBtn = document.createElement("i");
 editBtn.classList.add("fa", "fa-edit");
 actionBtns[i].appendChild(editBtn);
 var infoBtn = document.createElement("i");
 infoBtn.classList.add("fa", "fa-info");
 actionBtns[i].appendChild(infoBtn);
 editBtn.addEventListener('click',function(event){
 	$('#updateModal').modal();
 });
 infoBtn.addEventListener('click',function(event){
 $('#infoModal').modal();
 updateCommunity()
 });
}

function updateCommunity(ides,namess,statuses)
{
		var nameses = document.getElementById("nameses");
		nameses.innerHTML = namess;

		 $('#username').val(namess);
		 document.getElementById('role').value=statuses;

		 obj2 = new Object();
		 obj2.name = namess;
		 obj2._id = ides;
}

function updateCommunitydetails()
{
	obj2.status = document.getElementById('role').value;
	var request = new XMLHttpRequest();
			request.open('POST', '/updatecommunitydetails');
			request.setRequestHeader("Content-Type","application/json");
			request.send(JSON.stringify(obj2))
			request.addEventListener("load",function()
        	{
         		 console.log(request.responseText);

        	});
	table.ajax.reload(null, false);
}

function InfoCommunity(ides)
{
	$(document).on("click", "#infobut", function() {
	  	d = $(this).parent().parent()[0].children;
	  	var html = d[6].innerHTML;

		var re = /<img[^>]+src="http:\/\/([^">]+)/g
		var results = re.exec(html);

		// var source = results[0];



   		console.log(results)
		var memes = document.getElementById("memes");
		memes.innerHTML = d[0].innerHTML;

		 //document.getElementById("CommunityProfilePic").src=d[6].innerHTML;
  //   document.getElementById("locInfo").innerHTML=descrip;
   })

}

console.log(communtiydata);
  </script>

</html>
