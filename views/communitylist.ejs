<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CQ</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src="/trumbowyg.min.js"></script>

    <style>
    body{overflow-x: hidden;}
      *{
        box-sizing: border-box;
      }
      body{
        margin: 0;
        padding: 0;
        width: 100%;
        background: #f5f5f5;
        font-family: 'Roboto', sans-serif;
  }
  nav{
          position: absolute;
          width:100%;
          height: 60px;
    background-color: #222D3C;
          color: #fff;
  }
  nav p {
    margin: 0;
          float: left;
          height: 50px;
          padding: 15px 15px;
          font-size: 20px;
          line-height: 20px;
          font-weight: bold;
  }
  nav span {
          float: right;
          padding: .2em .6em .3em;
          margin-top: 22px;
          margin-left: 5px;
          font-size: 75%;
          line-height: 1;
          font-weight: 700;
          color: #fff;
          font-size: 14px;
          vertical-align: center;
          border-radius: .25em;
          vertical-align: baseline;
  }
  nav img {
    float: right;
    border-radius: 50%;
    padding: 15px;
      }
  #menu {
          padding-top: 60px;
          background-color: #000;
          width: 50px;
          height:100vh;
          color:white;
          box-sizing: border-box;
          overflow:hidden;
  }
  .fa {
    color: #fff;
    font-size: 25px;
    width: 30px;
    margin: 6px 15px;
    margin-left: 11px;
    box-sizing: border-box;
  }
  .menu-item {
          width: 250px;
    cursor: pointer;
    opacity: 0.8;
    color: #fff;
    font-family: sans-serif;
    font-size: 14px;
          padding-top: 10px;
  }
  .menu-item:hover {
    border-left: 2px solid red;
    opacity: 1;
    background-color: #4d5866;
  }
      #user_icon{
          height:100%;
          width: 10%;
      }
      .active{
          background: #51a1e2 !important;
      }
      #profile_button{
          cursor: pointer;
          padding: 0px;
          padding-left: 5px;
          padding-top: 5px;
          height: 60px;
      }
      #body_div{
    position:absolute;
    left:50px;
    right:0;
    top:64px;
    bottom:0;
    margin-left: 0.5%;
    overflow-x: hidden;
      }
.close{
  float: left;
}
  .main {
      margin-left: 100px;
      margin-top: 80px;
      background-color: rgb(250, 250, 250);
      transition: .5s;
      overflow-x: hidden;
  }
  #rightview{
    overflow-x: hidden;
  }
  .usertable {
      border-width: 1px;
      margin: 50px;
      border-style: solid;
      border-color: rgb(204, 203, 203);
      width: 100%;
      overflow-x: hidden;
  }

  .actioncolumn {
      text-align: center;

  }
  #editsubmit{
    background-color: grey;
    color:white;
  }
  .actionbut {

      padding: 5px 8px 5px 8px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
      color: white;
      display: inline-block;
  }

  .emailbut {
      background-color: black;
  }

  .editbut {
      background-color: black;
  }


  .deactivatebut {
      background-color: rgb(255, 196, 0);
  }

  .activatebut {
      background-color: rgb(81, 255, 0);
  }

  .well-lg {
  padding: 24px;
  border-radius: 6px;
}
.well {
  min-height: 20px;
  padding: 19px;
  margin-bottom: 20px;
  background-color: #f5f5f5;
  border: 1px solid #e3e3e3;
  border-radius: 4px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
}

p {
  margin: 0 0 10px;
}



@media (max-width: 768px)
{
#myModal, #deactivateuser, #updateModal
    {
      margin-top: 15%;
    }
}

  </style>
  </head>
  <body>
    <% include partials/menu.html %>
      <div id="body_div">
        <div id="rightview">
            <div class="container-fluid div-min-width" style="padding:0">
                <div class="row">
                    <div class="col-lg-12 parentDiv" style="padding:0">
                        <div class="to-center-div">

                            <div class="container childDiv">

                                <div class="panel panel-default" style="background: rgb(249, 249, 249);box-shadow: 0 3px 10px 0 rgba(115,143,147,.3);overflow-x: scroll;.inner-border::-webkit-scrollbar:display: none;">
                                    <div class="panel-body">

                                        <div class="userbtns">
    <button type="button" class="btn btn-primary" style="background-color: black">Community List</button>

    <select id="selectoption" class="btn btn-primary" class="mdb-select md-form colorful-select dropdown-primary" style="background-color: black;float: right;margin-left: 1%;">
          <option selected>All</option>
        <option value="direct">direct</option>
      <option value="permission">permission</option>
    </select>

     <button class="btn btn-primary" id="refresh" style="float: right;background-color: black;"><span class="glyphicon glyphicon-refresh"></span> Refresh</button>
  </div>

  <div>
    <table class="table table-bordered" id="datatableses">
        <thead>
        <tr>
            <th>Community Name</th>
            <th>Membership Rule</th>
            <th>Community Location</th>
            <th>Community Owner</th>
            <th>Create Date</th>
                    <th>Actions</th>
                    <th>Community Pic</th>
          </tr>
        </thead>
        <tbody id="list">

        </tbody>
      </table>

</div>


                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>

        </div>
      </div>
      <div id="updateModal" class="modal fade" role="dialog" style="z-index:9999;">
                                              <div class="modal-dialog">
                                                  <div class="modal-content">

                                                      <div class="modal-header">
                                                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                           <h3 id="eheading" style="text-align:left;" class="modal-title">Update <span id="nameses"></span></h3>
                                                      </div>

                                                      <div class="modal-body">
                                                              <div class="form-horizontal">
                                                              <div class="form-group">
                                                                  <div class="col-lg-5 col-lg-offset-3" style="width:50%;">
                                                                  </div>
                                                              </div>

                                                              <div class="form-group">
                                                                  <label class="control-label col-sm-2">Commuity Name:</label>
                                                                  <div class="col-sm-10">
                                                                      <input type="text" class="form-control" id="username" placeholder="Username" readonly>
                                                                  </div>
                                                              </div>

                                                              <div class="form-group">
                                                                  <label class="control-label col-sm-2">Community Status:</label>
                                                                  <div class="col-sm-10">
                                                                      <select class="form-control" id="role">
                                                                          <option value="active">Active</option>
                                                                          <option value="deactive">Deactive</option>
                                                                      </select>
                                                                  </div>
                                                              </div>



                                                              <div class="form-group">
                                                                  <div class="col-sm-offset-2 col-sm-10" style="text-align:left;">
                                                                      <button class = "btn btn-default" id="editsubmit" data-dismiss="modal" onclick="updateCommunitydetails()">Update</button>
                                                                  </div>
                                                              </div>


                                                          </div>
                                                      </div>

                                                      <div class="modal-footer">
                                                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                      </div>
                                              </div>
                                          </div>
                                      </div>




      <!-- Info Modal modal -->


      <div id="infoModal" class="modal fade" role="dialog" style="z-index:9999;">
                                              <div class="modal-dialog">
                                                  <div class="modal-content">

                                                      <div class="modal-header">
                                                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                          <div style="display: flex;">
                                                          <img src="/uploads/defaultCommunity.jpg" id="CommunityProfilePic" style="width: 100px;height: 100px;">
                                                           <h3 id="eheading" style="text-align:left;margin-top: 35px;margin-left: 10px;" class="modal-title">Community <span id="memes"></span></h3>
                                                           </div>
                                                      </div>

                                                      <p style="font-size:15px;font-weight:bold;padding: 10px;">Community Description</p>
                                                      <p id="locInfo" style="font-size:15px;margin-left: 15px;float:left"></p>
                                                      <div id="communityDesc" class="well well-lg" style="word-wrap: break-word;"></div>

                                                      <div class="modal-footer">
                                                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                      </div>
                                              </div>
                                          </div>
                                      </div>



  </body>
  <script>

  var span = menu.getElementsByTagName("span");
  var div = menu.getElementsByTagName('div');
  for(var i=0;i<div.length;i++){
      div[i].classList.remove("active");
    }

    div[4].classList.add("active");

$(document).ready(function(){
  $("#sideBtn").click(function(){
     if($("#menu").width() == 50){
        $("#menu").animate({width: '250px'},300);
        $("#body_div").animate({left:'250px'},300);
     } else{
        $("#menu").animate({width: '50px'},300);
        $("#body_div").animate({left:'50px'},300);
     }
  });
});
var obj2;
let table;
var communityDesc = document.getElementById('communityDesc');

$(document).ready(function() {
		  table = $('#datatableses').DataTable({
			"processing": true,
			"serverSide": true,
			"ajax": {
				"url": "/showcommunity",
				"type": "POST",
				"data": function ( d )
            	{
                	d.communitystatus = $('#selectoption').val();
            	},
			},
			"columns": [
			{
				"data" : "comname"
			},
			{
				"data" : "membershiprule"
			},
			{
				"data" : "location"
			},
			{
				"data" : "owner"
			},
			{
				"data" : "createdate"
			},
			{
				"data" : null,
      		    "orderable" : "false"
			},
			{
				"data" : null,
        		"orderable" : "false"
			},
			],
			"columnDefs": [{
                "targets": -2,

                "render": function (data, type, row, meta) {
                	//console.log(data.desc);
                	 let info = "info(\'" + data.communitydescription + "\')";
                	 console
                  return '<span class="actionbut editbut" id="editbut" onclick=updateCommunity("'+row._id+'","'+row.comname+'","'+row.communitystatus+'") data-toggle="modal" data-target="#updateModal"><i class="fas fa-edit"></i></span><span class="actionbut emailbut" id="infobut" onclick=\"' + info +'\" data-toggle="modal" data-target="#infoModal"><i class="fas fa-info"></i></span>';
                }
            },
            {
                "targets": -1,

                "render": function (data, type, row, meta) {

                   if(row.communitystatus=="active")
                      data ='<img src=/'+ row.image +' style="width: 80px;height: 80px;border: 4px solid green;">';
                  else
                     data ='<img src=/'+row.image+' style="width: 80px;height: 80px;border: 4px solid red;">';
                return data;
                }
            }],

		});

		 $('#refresh').on('click', function () {
		 //	console.log('cd')
        table.ajax.reload(null, false);
   		 });


        $('#selectoption').on('click', function () {
        table.ajax.reload(null, false);
    	});
});



function updateCommunity(ides,namess,statuses)
{
		var nameses = document.getElementById("nameses");
		nameses.innerHTML = namess;

		 $('#username').val(namess);
		 document.getElementById('role').value=statuses;

		 obj2 = new Object();
		 obj2.comname = namess;
		 obj2._id = ides;
}

function updateCommunitydetails()
{
	obj2.communitystatus = document.getElementById('role').value;
	var request = new XMLHttpRequest();
			request.open('POST', '/updatecommunitydetails1');
			request.setRequestHeader("Content-Type","application/json");
			request.send(JSON.stringify(obj2))
			request.addEventListener("load",function()
        	{
         		 console.log(request.responseText);

        	});
	table.ajax.reload(null, false);
}

function info(desc)
{

	$(document).on("click", "#infobut", function() {
	  	d = $(this).parent().parent()[0].children;
	  	var html = d[6].innerHTML;

		communityDesc.innerHTML = desc;

		var memes = document.getElementById("memes");
		memes.innerHTML = d[0].innerHTML;

		document.getElementById("CommunityProfilePic").src = d[6].lastChild.currentSrc;
   })

}


  </script>

</html>
